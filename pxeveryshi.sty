%
% pxeveryshi.sty
% originally written by Takayuki Yato (ZR)
% and modified by Hironobu Yamashita
%
% This package is distributed as part of the platex-tools bundle
% maintained by Hironobu Yamashita
% by courtesy of the original author.
% https://github.com/aminophen/platex-tools
%
% --------------------------------------------------------------------
% [Note]
% Update: version 2020/09/25 v0.2 does nothing, since
% pLaTeX2e 2020-10-01 will support the situation natively.
% --------------------------------------------------------------------
%

\NeedsTeXFormat{pLaTeX2e}
\ProvidesPackage{pxeveryshi}
    [2020/09/25 v0.2 everyshi package for pLaTeX]
\RequirePackageWithOptions{everyshi}

%% Since LaTeX2e 2020-10-01, everyshi.sty is merely
%% an emulation by everyshi-ltx.sty from ltshipout.dtx.
%% The new code does NOT define \@EveryShipout@Output,
%% so we can detect it!

\ifx\@EveryShipout@Output\@undefined
  %% pLaTeX2e 2020-10-01 natively supports the situation
  \PackageInfo{pxeveryshi}{This package is no longer needed}
  \expandafter\endinput
\fi

%% The rest of this package is meant for
%% LaTeX2e 2020-02-02 PL5 or older.

\def\@EveryShipout@Output{%
  \setbox8\vbox{%
    \yoko
    \@EveryShipout@Hook
    \@EveryShipout@AtNextHook
    \global\setbox\@cclv=\box\@cclv
  }%
  \gdef\@EveryShipout@AtNextHook{}%
  \@EveryShipout@Org@Shipout\box\@cclv
}

\endinput
%% EOF
